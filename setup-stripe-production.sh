#!/bin/bash

# Script para Configurar Stripe em Produ√ß√£o para Fixelo
# Execute este script ap√≥s configurar suas chaves do Stripe

echo "üöÄ CONFIGURA√á√ÉO STRIPE PARA FIXELO EM PRODU√á√ÉO"
echo "=============================================="

# Verificar se as chaves est√£o configuradas
if [ -z "$STRIPE_SECRET_KEY" ]; then
    echo "‚ùå STRIPE_SECRET_KEY n√£o encontrada nas vari√°veis de ambiente"
    echo "Configure suas chaves do Stripe no arquivo .env.production"
    exit 1
fi

echo "‚úÖ Chaves do Stripe encontradas"
echo "üîÑ Criando produtos e pre√ßos no Stripe..."

# Executar script de cria√ß√£o de produtos
node create-stripe-products.js

echo ""
echo "üìã INSTRU√á√ïES PARA CONFIGURAR STRIPE DASHBOARD:"
echo ""
echo "1. üåê Acesse: https://dashboard.stripe.com/"
echo "2. üîë Configure suas chaves de produ√ß√£o:"
echo "   - V√° em Developers > API keys"
echo "   - Copie a Secret key (sk_live_...)"
echo "   - Copie a Publishable key (pk_live_...)"
echo ""
echo "3. üîó Configure Webhooks:"
echo "   - V√° em Developers > Webhooks"
echo "   - Clique em 'Add endpoint'"
echo "   - URL: https://api.fixelo.app/api/v1/stripe/webhook"
echo "   - Eventos para escutar:"
echo "     * customer.subscription.created"
echo "     * customer.subscription.updated"
echo "     * customer.subscription.deleted"
echo "     * invoice.payment_succeeded"
echo "     * invoice.payment_failed"
echo "     * checkout.session.completed"
echo ""
echo "4. üì± Configure Produtos (Planos de Assinatura):"
echo ""
echo "   üì¶ PLANO FREE (Gratuito):"
echo "   - Nome: Fixelo Free Plan"
echo "   - Descri√ß√£o: Plan gratuito para prestadores de servi√ßo"
echo "   - Pre√ßo: $0/m√™s"
echo "   - Benef√≠cios:"
echo "     * At√© 10 leads/m√™s"
echo "     * Perfil b√°sico"
echo "     * Avalia√ß√µes de clientes"
echo "     * Leads extras: $3 cada"
echo ""
echo "   üíé PLANO PRO:"
echo "   - Nome: Fixelo Pro Plan"
echo "   - Descri√ß√£o: Plano profissional para prestadores de servi√ßo"
echo "   - Pre√ßo Mensal: $34.80/m√™s"
echo "   - Pre√ßo Anual: $334.08/ano (20% desconto)"
echo "   - Benef√≠cios:"
echo "     * Leads e mensagens ilimitados"
echo "     * Badge verificado"
echo "     * Visibilidade top nas buscas"
echo "     * Dashboard de analytics"
echo "     * Acesso a boost/ads"
echo "     * Suporte priorit√°rio"
echo "     * 7 dias de teste gr√°tis"
echo ""
echo "5. üí∞ Configure Taxa da Plataforma:"
echo "   - 5% de taxa em todas as transa√ß√µes"
echo "   - Configure no Stripe Connect (se usando)"
echo ""
echo "6. üîî Configure Notifica√ß√µes:"
echo "   - Email para falhas de pagamento"
echo "   - SMS para alertas cr√≠ticos"
echo ""
echo "7. üìä Configure Analytics:"
echo "   - Stripe Sigma para relat√≥rios avan√ßados"
echo "   - Webhooks para sincronizar com dashboard interno"
echo ""
echo "üìù VARI√ÅVEIS DE AMBIENTE NECESS√ÅRIAS:"
echo ""
echo "Ap√≥s criar os produtos, adicione no .env.production:"
echo "STRIPE_SECRET_KEY=sk_live_..."
echo "STRIPE_PUBLISHABLE_KEY=pk_live_..."
echo "STRIPE_WEBHOOK_SECRET=whsec_..."
echo "STRIPE_FREE_PRODUCT_ID=prod_..."
echo "STRIPE_PRO_PRODUCT_ID=prod_..."
echo "STRIPE_PRO_MONTHLY_PRICE_ID=price_..."
echo "STRIPE_PRO_YEARLY_PRICE_ID=price_..."
echo ""
echo "üîí SEGURAN√áA:"
echo "- Nunca exponha as chaves secretas (sk_live_)"
echo "- Use HTTPS em todos os endpoints"
echo "- Valide webhooks com assinatura"
echo "- Configure rate limiting nos endpoints"
echo ""
echo "üß™ TESTE EM PRODU√á√ÉO:"
echo "curl -X POST https://api.fixelo.app/api/v1/stripe/create-checkout-session \\"
echo "  -H 'Content-Type: application/json' \\"
echo "  -H 'Authorization: Bearer YOUR_JWT_TOKEN' \\"
echo "  -d '{\"priceId\": \"price_pro_monthly_id\"}'"
echo ""
echo "‚úÖ Configura√ß√£o conclu√≠da!"
echo "Acesse https://dashboard.stripe.com para finalizar a configura√ß√£o"
